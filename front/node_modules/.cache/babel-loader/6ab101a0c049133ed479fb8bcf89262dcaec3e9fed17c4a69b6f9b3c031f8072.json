{"ast":null,"code":"import logo from'./logo.svg';import'./App.css';import{useEffect,useRef,useState}from\"react\";import axios from\"axios\";import Playlist from\"./Components/Playlist\";import{addDoc,collection}from\"@firebase/firestore\";import{db}from\"./firebase\";import handleSubmit from\"./handlers/handleSubmit\";import handleMsg from\"./handlers/handleMsg\";import{doc,getDoc}from\"firebase/firestore\";import{getDocs}from\"firebase/firestore\";import GroupComponent from\"./Components/GroupComponent\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){const CLIENT_ID='59097828c7c14767b30fdc16ede83d49';const REDIRET_URI='http://localhost:3000/api/auth/callback/spotify';const AUTH_ENDPOINT='https://accounts.spotify.com/authorize';const RESPONSE_TYPE='token';const SCOPES='user-read-private user-read-email';// Include 'user-read-email' scope\nconst[token,setToken]=useState(\"\");useEffect(()=>{const hash=window.location.hash;let token=window.localStorage.getItem(\"token\");if(!token&&hash){token=hash.substring(1).split(\"&\").find(el=>el.startsWith(\"access_token\")).split(\"=\")[1];window.location.hash=\"\";window.localStorage.setItem(\"token\",token);}setToken(token);if(token){axios.get(\"https://api.spotify.com/v1/me\",{headers:{Authorization:'Bearer '+token}}).then(response=>{const username=response.data.display_name||response.data.id;if(response.data.email){const email=response.data.email;retrieveUserData(email);const type=response.data.product;//console.log(\"Email:\", email);\nhandleSubmit(email,username,type);window.localStorage.setItem(\"email\",email);}else{console.log(\"Email not available\");}}).catch(error=>{console.error(\"Error fetching user information:\",error);});let response=axios.get(\"http://localhost:8080/createUser\",{\"username\":\"fabijan2\"});if(response.status===200){console.log(\"User added\");}}},[]);const retrieveUserData=async email=>{const loginRef=doc(db,\"login\",email);try{const docSnap=await getDoc(loginRef);if(docSnap.exists()){const userData=docSnap.data();console.log(\"User Data:\",userData);}else{console.log(\"No such document!\");}}catch(e){console.error(\"Error getting document:\",e);}};const logOut=()=>{setToken(\"\");window.localStorage.removeItem(\"token\");};return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsxs(\"header\",{className:\"App-header\",children:[token&&/*#__PURE__*/_jsx(GroupComponent,{}),/*#__PURE__*/_jsx(\"div\",{className:\"user-info-box\",children:/*#__PURE__*/_jsx(\"div\",{className:\"upperPart\",children:token?/*#__PURE__*/_jsx(\"button\",{onClick:logOut,children:\"Log out\"}):/*#__PURE__*/_jsx(\"a\",{href:\"\".concat(AUTH_ENDPOINT,\"?client_id=\").concat(CLIENT_ID,\"&redirect_uri=\").concat(REDIRET_URI,\"&response_type=\").concat(RESPONSE_TYPE,\"&scope=\").concat(encodeURIComponent(SCOPES)),children:\"Login\"})})})]})});}export default App;","map":{"version":3,"names":["logo","useEffect","useRef","useState","axios","Playlist","addDoc","collection","db","handleSubmit","handleMsg","doc","getDoc","getDocs","GroupComponent","jsx","_jsx","jsxs","_jsxs","App","CLIENT_ID","REDIRET_URI","AUTH_ENDPOINT","RESPONSE_TYPE","SCOPES","token","setToken","hash","window","location","localStorage","getItem","substring","split","find","el","startsWith","setItem","get","headers","Authorization","then","response","username","data","display_name","id","email","retrieveUserData","type","product","console","log","catch","error","status","loginRef","docSnap","exists","userData","e","logOut","removeItem","className","children","onClick","href","concat","encodeURIComponent"],"sources":["C:/Users/Fabijan/Documents/drumre-projekt/front/src/App.js"],"sourcesContent":["import logo from './logo.svg';\r\nimport './App.css'\r\n\r\nimport {useEffect, useRef, useState} from \"react\";\r\nimport axios from \"axios\";\r\nimport Playlist from \"./Components/Playlist\";\r\nimport {addDoc, collection} from \"@firebase/firestore\"\r\nimport {db} from \"./firebase\";\r\nimport handleSubmit from \"./handlers/handleSubmit\";\r\nimport handleMsg from \"./handlers/handleMsg\";\r\nimport {doc, getDoc} from \"firebase/firestore\";\r\nimport {  getDocs } from \"firebase/firestore\";\r\nimport GroupComponent from \"./Components/GroupComponent\";\r\n\r\n\r\nfunction App() {\r\n\r\n    const CLIENT_ID = '59097828c7c14767b30fdc16ede83d49'\r\n    const REDIRET_URI = 'http://localhost:3000/api/auth/callback/spotify'\r\n    const AUTH_ENDPOINT = 'https://accounts.spotify.com/authorize'\r\n    const RESPONSE_TYPE = 'token'\r\n    const SCOPES = 'user-read-private user-read-email'; // Include 'user-read-email' scope\r\n    const [token, setToken] = useState(\"\")\r\n\r\n\r\n    useEffect(() => {\r\n        const hash = window.location.hash\r\n        let token = window.localStorage.getItem(\"token\")\r\n        if (!token && hash) {\r\n            token = hash.substring(1).split(\"&\").find(el => el.startsWith(\"access_token\")).split(\"=\")[1]\r\n            window.location.hash = \"\"\r\n            window.localStorage.setItem(\"token\", token)\r\n        }\r\n        setToken(token)\r\n        if (token) {\r\n            axios.get(\"https://api.spotify.com/v1/me\", {\r\n                headers: {\r\n                    Authorization: 'Bearer ' + token\r\n                }\r\n            })\r\n                .then(response => {\r\n                    const username = response.data.display_name || response.data.id;\r\n                    if (response.data.email) {\r\n                        const email = response.data.email;\r\n                        retrieveUserData(email)\r\n                        const type = response.data.product;\r\n                        //console.log(\"Email:\", email);\r\n                        handleSubmit(email, username, type)\r\n                        window.localStorage.setItem(\"email\", email)\r\n                    } else {\r\n                        console.log(\"Email not available\");\r\n                    }\r\n                })\r\n                .catch(error => {\r\n                    console.error(\"Error fetching user information:\", error);\r\n                });\r\n            let response = axios.get(\"http://localhost:8080/createUser\",{\r\n                \"username\" : \"fabijan2\"\r\n            })\r\n            if(response.status === 200) {\r\n                console.log(\"User added\")\r\n            }\r\n        }\r\n    }, [])\r\n\r\n    const retrieveUserData = async (email) => {\r\n        const loginRef = doc(db, \"login\", email);\r\n\r\n        try {\r\n            const docSnap = await getDoc(loginRef);\r\n            if (docSnap.exists()) {\r\n                const userData = docSnap.data();\r\n                console.log(\"User Data:\", userData);\r\n            } else {\r\n                console.log(\"No such document!\");\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Error getting document:\", e);\r\n        }\r\n    };\r\n    const logOut = () => {\r\n        setToken(\"\")\r\n        window.localStorage.removeItem(\"token\")\r\n\r\n    }\r\n\r\n\r\n\r\n    return (\r\n        <div className=\"App\">\r\n            <header className=\"App-header\">\r\n                    {token && (\r\n                        <GroupComponent></GroupComponent>\r\n\r\n                    )}\r\n                <div className=\"user-info-box\">\r\n\r\n                    <div className=\"upperPart\">\r\n                        {token ? (\r\n                            <button onClick={logOut}>Log out</button>\r\n                        ) : (\r\n                            <a href={`${AUTH_ENDPOINT}?client_id=${CLIENT_ID}&redirect_uri=${REDIRET_URI}&response_type=${RESPONSE_TYPE}&scope=${encodeURIComponent(SCOPES)}`}>Login</a>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </header>\r\n        </div>\r\n    );\r\n\r\n}\r\n\r\nexport default App;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}